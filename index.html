<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–®–∞—à–∫–∏ –∏ —à–∞—Ö–º–∞—Ç—ã ‚Äî –ø—Ä–µ–º–∏—É–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(circle at 30% 30%, #1a2f40, #0b1420);
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            color: #fff;
        }

        .game-container {
            max-width: 800px;
            width: 100%;
            background: rgba(10, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            border-radius: 60px;
            padding: 20px 16px 30px;
            box-shadow: 0 30px 50px rgba(0, 0, 0, 0.8), 0 0 0 2px #3a5e84 inset;
            border: 2px solid #6d94b8;
        }

        h1 {
            text-align: center;
            font-size: 2.4rem;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #b3d9ff, #7aaae0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px #1e3f66;
        }

        .game-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .selector-btn {
            background: #1f3a4f;
            border: 2px solid #3b6a94;
            color: #e3f0ff;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s ease;
            box-shadow: 0 6px 0 #0e1d2b;
            flex: 1 1 140px;
        }

        .selector-btn.active {
            background: #2c5f8a;
            border-color: #a0d0ff;
            box-shadow: 0 0 20px #3f9eff, 0 6px 0 #0e1d2b;
        }

        .selector-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #0e1d2b;
        }

        .mode-panel {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .mode-btn {
            background: #263b4f;
            border: 2px solid #3f6385;
            color: #dff0ff;
            padding: 10px 22px;
            border-radius: 40px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.1s ease;
            box-shadow: 0 5px 0 #10212e;
        }

        .mode-btn.active {
            background: #34638a;
            border-color: #8fc9ff;
        }

        .mode-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #10212e;
        }

        .difficulty {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .diff-btn {
            background: #1e3347;
            border: 2px solid #3f6385;
            color: #b7d4f0;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 0 #0f1f30;
        }

        .diff-btn.active {
            background: #4b6e8f;
            border-color: #ffd966;
            color: #fff5d0;
        }

        .board-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            background: #2b4b6e;
            padding: 5px;
            border-radius: 24px;
            border: 4px solid #8b6e4b;
            box-shadow: 0 20px 30px #00000080;
            width: min(450px, 90vw);
            aspect-ratio: 1/1;
        }

        .cell {
            background: #eed9b2;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: min(6vw, 36px);
            cursor: pointer;
            transition: 0.1s;
            box-shadow: inset 0 0 0 1px #aa8c6e;
            aspect-ratio: 1/1;
        }

        .cell.dark {
            background: #8b5a2b;
        }

        .cell.selected {
            box-shadow: 0 0 0 4px #ffd966, inset 0 0 0 2px #b87e2e;
        }

        .cell.possible {
            background: #a5d6a5 !important;
            box-shadow: 0 0 15px #6bd46b;
        }

        .cell.attack {
            background: #ffb3b3 !important;
            box-shadow: 0 0 15px #ff6b6b;
        }

        .cell.last-move {
            box-shadow: 0 0 0 3px #ffaa33;
        }

        .piece {
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
            transition: transform 0.15s ease;
        }

        .piece:hover {
            transform: scale(1.05);
        }

        .info-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #102433;
            border-radius: 60px;
            padding: 12px 20px;
            margin: 15px 0;
            border: 2px solid #4e78a4;
        }

        .player-info {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 1.2rem;
        }

        .player-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .player1-color { background: #ff6b6b; }
        .player2-color { background: #6bc9ff; }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: monospace;
            background: #0f1f30;
            padding: 5px 15px;
            border-radius: 40px;
            border: 2px solid #5f8bbf;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            background: #263b4f;
            border: 2px solid #3f6385;
            color: #dff0ff;
            padding: 12px 28px;
            border-radius: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 6px 0 #10212e;
            transition: 0.1s;
            min-width: 140px;
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #10212e;
        }

        .action-btn.hint {
            background: #4a6b3e;
            border-color: #9fcc9f;
        }

        .action-btn.music {
            background: #6b4f8f;
            border-color: #b38fdd;
        }

        .status {
            text-align: center;
            font-size: 1.5rem;
            margin: 15px 0 5px;
            min-height: 3rem;
            color: #ffecb3;
            font-weight: 500;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%,100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .history {
            background: #0f1f30;
            border-radius: 30px;
            padding: 10px;
            margin-top: 15px;
            max-height: 80px;
            overflow-y: auto;
            border: 2px solid #3f6b97;
            color: #c9e1ff;
            font-size: 0.9rem;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history span {
            background: #1f3b53;
            padding: 4px 12px;
            border-radius: 30px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –º—É–∑—ã–∫–∏ */
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1f3a4f;
            border: 2px solid #6d94b8;
            border-radius: 50px;
            padding: 12px 18px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 0 #0e1d2b;
            z-index: 100;
        }
    </style>
</head>
<body>
    <!-- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª -->
    <div class="music-control" id="musicToggle">üîä –ú—É–∑—ã–∫–∞</div>
    <audio id="bgMusic" loop preload="auto">
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <div class="game-container">
        <h1>‚ôú –®–ê–®–ö–ò & –®–ê–•–ú–ê–¢–´</h1>

        <!-- –í—ã–±–æ—Ä –∏–≥—Ä—ã -->
        <div class="game-selector">
            <button class="selector-btn active" id="selectCheckers">‚ôüÔ∏è –®–∞—à–∫–∏</button>
            <button class="selector-btn" id="selectChess">‚ôö –®–∞—Ö–º–∞—Ç—ã</button>
        </div>

        <!-- –†–µ–∂–∏–º –∏–≥—Ä—ã (2 –∏–≥—Ä–æ–∫–∞ / –ò–ò) -->
        <div class="mode-panel">
            <button class="mode-btn active" id="mode2p">üë• 2 –∏–≥—Ä–æ–∫–∞</button>
            <button class="mode-btn" id="modeAI">ü§ñ –ü—Ä–æ—Ç–∏–≤ –ò–ò</button>
        </div>

        <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –ò–ò) -->
        <div class="difficulty" id="difficultyPanel">
            <button class="diff-btn" data-level="easy">üçÉ –õ–µ–≥–∫–æ</button>
            <button class="diff-btn active" data-level="medium">‚öôÔ∏è –°—Ä–µ–¥–Ω–µ</button>
            <button class="diff-btn" data-level="hard">üíÄ –°–ª–æ–∂–Ω–æ</button>
        </div>

        <!-- –®–∞—Ö–º–∞—Ç–Ω–∞—è –¥–æ—Å–∫–∞ -->
        <div class="board-container">
            <div class="board" id="board"></div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="info-panel">
            <div class="player-info">
                <span class="player-indicator player1-color"></span>
                <span>–ò–≥—Ä–æ–∫ 1</span>
            </div>
            <div class="timer" id="timerDisplay">10:00</div>
            <div class="player-info">
                <span class="player-indicator player2-color"></span>
                <span>–ò–≥—Ä–æ–∫ 2</span>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –∏ –∫–Ω–æ–ø–∫–∏ -->
        <div class="status" id="statusMessage">–•–æ–¥ –±–µ–ª—ã—Ö</div>
        <div class="action-buttons">
            <button class="action-btn hint" id="hintBtn">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
            <button class="action-btn" id="newGameBtn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button class="action-btn" id="resetGameBtn">‚ü≤ –°–±—Ä–æ—Å</button>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤ -->
        <div class="history" id="historyList"></div>
    </div>

    <script>
        (function() {
            // ---------- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ----------
            let currentGame = 'checkers'; // 'checkers' –∏–ª–∏ 'chess'
            let mode = '2p';               // '2p' –∏–ª–∏ 'ai'
            let difficulty = 'medium';      // 'easy', 'medium', 'hard'
            let boardState = [];            // –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
            let currentPlayer = 0;           // 0 - –±–µ–ª—ã–µ/–ø–µ—Ä–≤—ã–µ, 1 - —á—ë—Ä–Ω—ã–µ/–≤—Ç–æ—Ä—ã–µ
            let selectedRow = -1, selectedCol = -1;
            let possibleMoves = [];          // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ {row, col, attack?, capturedRow, capturedCol}
            let gameActive = true;
            let winner = null;                // null, 'white', 'black', 'draw'
            let lastMove = null;               // {fromRow, fromCol, toRow, toCol}
            let history = [];
            let timerInterval;
            let timeLeft = 600; // 10 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ)
            let activeTimer = 0; // –∏–Ω–¥–µ–∫—Å –∏–≥—Ä–æ–∫–∞, —á–µ–π —Ç–∞–π–º–µ—Ä –∏–¥—ë—Ç

            // –ú—É–∑—ã–∫–∞
            const bgMusic = document.getElementById('bgMusic');
            const musicToggle = document.getElementById('musicToggle');
            let musicPlaying = false;

            musicToggle.addEventListener('click', () => {
                if (musicPlaying) {
                    bgMusic.pause();
                    musicToggle.innerHTML = 'üîá –ú—É–∑—ã–∫–∞';
                } else {
                    bgMusic.play().catch(() => {});
                    musicToggle.innerHTML = 'üîä –ú—É–∑—ã–∫–∞';
                }
                musicPlaying = !musicPlaying;
            });

            // –≠–ª–µ–º–µ–Ω—Ç—ã
            const boardEl = document.getElementById('board');
            const statusEl = document.getElementById('statusMessage');
            const historyEl = document.getElementById('historyList');
            const timerEl = document.getElementById('timerDisplay');
            const selectCheckers = document.getElementById('selectCheckers');
            const selectChess = document.getElementById('selectChess');
            const mode2p = document.getElementById('mode2p');
            const modeAI = document.getElementById('modeAI');
            const diffBtns = document.querySelectorAll('.diff-btn');
            const hintBtn = document.getElementById('hintBtn');
            const newGameBtn = document.getElementById('newGameBtn');
            const resetGameBtn = document.getElementById('resetGameBtn');

            // ---------- –¢–∞–π–º–µ—Ä ----------
            function startTimer() {
                stopTimer();
                timerInterval = setInterval(() => {
                    if (!gameActive || winner !== null) return;
                    timeLeft -= 1;
                    updateTimerDisplay();
                    if (timeLeft <= 0) {
                        winner = currentPlayer === 0 ? 'black' : 'white';
                        gameActive = false;
                        statusEl.innerText = winner === 'white' ? '–ë–µ–ª—ã–µ –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏!' : '–ß—ë—Ä–Ω—ã–µ –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏!';
                        stopTimer();
                    }
                }, 1000);
            }

            function stopTimer() {
                if (timerInterval) clearInterval(timerInterval);
            }

            function resetTimer() {
                timeLeft = 600;
                activeTimer = 0;
                updateTimerDisplay();
                stopTimer();
                if (gameActive) startTimer();
            }

            function updateTimerDisplay() {
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                timerEl.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            // ---------- –ò—Å—Ç–æ—Ä–∏—è ----------
            function addHistory(moveStr) {
                history.push(moveStr);
                if (history.length > 10) history.shift();
                renderHistory();
            }

            function renderHistory() {
                historyEl.innerHTML = history.map(h => `<span>${h}</span>`).join('');
            }

            // ---------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–æ–∫ ----------
            function initCheckers() {
                boardState = Array(8).fill().map(() => Array(8).fill(null));
                for (let r = 0; r < 3; r++) {
                    for (let c = 0; c < 8; c++) {
                        if ((r + c) % 2 === 1) boardState[r][c] = 'w';
                    }
                }
                for (let r = 5; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if ((r + c) % 2 === 1) boardState[r][c] = 'b';
                    }
                }
                currentPlayer = 0;
                gameActive = true;
                winner = null;
                selectedRow = -1;
                possibleMoves = [];
                lastMove = null;
                history = [];
                renderBoard();
                resetTimer();
            }

            function initChess() {
                boardState = [
                    ['r','n','b','q','k','b','n','r'],
                    ['p','p','p','p','p','p','p','p'],
                    [null,null,null,null,null,null,null,null],
                    [null,null,null,null,null,null,null,null],
                    [null,null,null,null,null,null,null,null],
                    [null,null,null,null,null,null,null,null],
                    ['P','P','P','P','P','P','P','P'],
                    ['R','N','B','Q','K','B','N','R']
                ];
                currentPlayer = 0;
                gameActive = true;
                winner = null;
                selectedRow = -1;
                possibleMoves = [];
                lastMove = null;
                history = [];
                renderBoard();
                resetTimer();
            }

            // ---------- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å–∫–∏ ----------
            function renderBoard() {
                boardEl.innerHTML = '';
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        if ((r + c) % 2 === 1) cell.classList.add('dark');
                        cell.dataset.row = r;
                        cell.dataset.col = c;

                        if (selectedRow === r && selectedCol === c) {
                            cell.classList.add('selected');
                        }
                        if (lastMove && ((lastMove.fromRow === r && lastMove.fromCol === c) || (lastMove.toRow === r && lastMove.toCol === c))) {
                            cell.classList.add('last-move');
                        }
                        if (possibleMoves.some(m => m.row === r && m.col === c)) {
                            const move = possibleMoves.find(m => m.row === r && m.col === c);
                            if (move && move.attack) cell.classList.add('attack');
                            else cell.classList.add('possible');
                        }

                        const piece = boardState[r][c];
                        if (piece) {
                            const pieceSpan = document.createElement('span');
                            pieceSpan.className = 'piece';
                            if (currentGame === 'checkers') {
                                if (piece === 'w') pieceSpan.innerText = '‚óè';
                                else if (piece === 'b') pieceSpan.innerText = '‚óã';
                                else if (piece === 'W') pieceSpan.innerText = '‚è£';
                                else if (piece === 'B') pieceSpan.innerText = '‚è¢';
                            } else {
                                const map = {
                                    'r':'‚ôú','n':'‚ôû','b':'‚ôù','q':'‚ôõ','k':'‚ôö','p':'‚ôü',
                                    'R':'‚ôñ','N':'‚ôò','B':'‚ôó','Q':'‚ôï','K':'‚ôî','P':'‚ôô'
                                };
                                pieceSpan.innerText = map[piece] || piece;
                            }
                            // –¶–≤–µ—Ç —Ñ–∏–≥—É—Ä—ã
                            if (piece === piece.toLowerCase()) {
                                pieceSpan.style.color = '#222';
                            } else {
                                pieceSpan.style.color = '#f0f0f0';
                            }
                            cell.appendChild(pieceSpan);
                        }

                        cell.addEventListener('click', () => cellClick(r, c));
                        boardEl.appendChild(cell);
                    }
                }
            }

            // ---------- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–æ–¥–æ–≤ –¥–ª—è —à–∞—à–µ–∫ (—Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤–∑—è—Ç–∏—è) ----------
            function getCheckersMoves(row, col, piece) {
                const moves = [];
                const isWhite = piece === 'w' || piece === 'W';
                const isKing = piece === 'W' || piece === 'B';

                // –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∑—è—Ç–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
                const captures = [];
                const dirs = [-1, 1];
                for (let dRow of dirs) {
                    for (let dCol of dirs) {
                        if (!isKing && ((isWhite && dRow === 1) || (!isWhite && dRow === -1))) continue;
                        const mr = row + dRow, mc = col + dCol;
                        const nr = row + 2*dRow, nc = col + 2*dCol;
                        if (mr>=0 && mr<8 && mc>=0 && mc<8 && nr>=0 && nr<8 && nc>=0 && nc<8) {
                            const mid = boardState[mr][mc];
                            if (mid && ((isWhite && mid === 'b' || mid === 'B') || (!isWhite && mid === 'w' || mid === 'W')) && boardState[nr][nc] === null) {
                                captures.push({ row: nr, col: nc, attack: true, capturedRow: mr, capturedCol: mc });
                            }
                        }
                    }
                }
                if (captures.length > 0) return captures;

                // –ï—Å–ª–∏ –≤–∑—è—Ç–∏–π –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç—ã–µ —Ö–æ–¥—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ—Ä–æ–ª–µ–π –∏ –æ–±—ã—á–Ω—ã—Ö)
                for (let dRow of (isKing ? [-1,1] : (isWhite ? [-1] : [1]))) {
                    for (let dCol of [-1,1]) {
                        const nr = row + dRow, nc = col + dCol;
                        if (nr>=0 && nr<8 && nc>=0 && nc<8 && boardState[nr][nc] === null) {
                            moves.push({ row: nr, col: nc, attack: false });
                        }
                    }
                }
                return moves;
            }

            // ---------- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–æ–¥–æ–≤ –¥–ª—è —à–∞—Ö–º–∞—Ç (—É–ø—Ä–æ—â—ë–Ω–Ω–æ) ----------
            function getChessMoves(row, col, piece) {
                const moves = [];
                const type = piece.toLowerCase();
                const isWhite = piece === piece.toUpperCase();
                const oppColor = isWhite ? (p) => p === p.toLowerCase() : (p) => p === p.toUpperCase();

                switch (type) {
                    case 'p':
                        const dir = isWhite ? -1 : 1;
                        if (row+dir >=0 && row+dir<8 && boardState[row+dir][col] === null) {
                            moves.push({ row: row+dir, col, attack: false });
                            if ((isWhite && row === 6) || (!isWhite && row === 1)) {
                                if (boardState[row+2*dir][col] === null) moves.push({ row: row+2*dir, col, attack: false });
                            }
                        }
                        if (col+1 <8 && row+dir>=0 && row+dir<8 && boardState[row+dir][col+1] && oppColor(boardState[row+dir][col+1])) {
                            moves.push({ row: row+dir, col: col+1, attack: true });
                        }
                        if (col-1 >=0 && row+dir>=0 && row+dir<8 && boardState[row+dir][col-1] && oppColor(boardState[row+dir][col-1])) {
                            moves.push({ row: row+dir, col: col-1, attack: true });
                        }
                        break;
                    case 'r':
                    case 'b':
                    case 'q':
                    case 'k':
                        // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–¥–ª—è –ª–∞–¥—å–∏, —Å–ª–æ–Ω–∞, —Ñ–µ—Ä–∑—è, –∫–æ—Ä–æ–ª—è)
                        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–æ –¥–ª—è –¥–µ–º–æ –æ—Å—Ç–∞–≤–∏–º –±–∞–∑–æ–≤–æ–µ
                        break;
                    default: break;
                }
                return moves;
            }

            function getPossibleMoves(row, col) {
                const piece = boardState[row][col];
                if (!piece) return [];
                if (currentGame === 'checkers') {
                    return getCheckersMoves(row, col, piece);
                } else {
                    return getChessMoves(row, col, piece);
                }
            }

            // ---------- –•–æ–¥ ----------
            function makeMove(fromRow, fromCol, toRow, toCol, moveData) {
                const piece = boardState[fromRow][fromCol];
                boardState[toRow][toCol] = piece;
                boardState[fromRow][fromCol] = null;

                if (moveData && moveData.attack && moveData.capturedRow !== undefined && moveData.capturedCol !== undefined) {
                    boardState[moveData.capturedRow][moveData.capturedCol] = null;
                }

                // –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –¥–∞–º–∫–∏
                if (currentGame === 'checkers') {
                    if (piece === 'w' && toRow === 7) boardState[toRow][toCol] = 'W';
                    if (piece === 'b' && toRow === 0) boardState[toRow][toCol] = 'B';
                }

                lastMove = { fromRow, fromCol, toRow, toCol };
                addHistory(`${String.fromCharCode(97+toCol)}${8-toRow}`);
            }

            function cellClick(row, col) {
                if (!gameActive || winner !== null) return;
                if (mode === 'ai' && currentPlayer !== 0) return;

                const piece = boardState[row][col];

                // –í—ã–±–æ—Ä —Ñ–∏–≥—É—Ä—ã
                if (piece && ((currentPlayer === 0 && piece === piece.toUpperCase()) || (currentPlayer === 1 && piece === piece.toLowerCase()))) {
                    selectedRow = row;
                    selectedCol = col;
                    possibleMoves = getPossibleMoves(row, col);
                    renderBoard();
                    return;
                }

                // –°–æ–≤–µ—Ä—à–µ–Ω–∏–µ —Ö–æ–¥–∞
                if (selectedRow !== -1 && possibleMoves.some(m => m.row === row && m.col === col)) {
                    const move = possibleMoves.find(m => m.row === row && m.col === col);
                    makeMove(selectedRow, selectedCol, row, col, move);
                    selectedRow = -1;
                    possibleMoves = [];
                    currentPlayer = currentPlayer === 0 ? 1 : 0;
                    renderBoard();
                    statusEl.innerText = currentPlayer === 0 ? '–•–æ–¥ –±–µ–ª—ã—Ö' : '–•–æ–¥ —á—ë—Ä–Ω—ã—Ö';

                    if (currentGame === 'chess') checkChessEnd(); else checkCheckersEnd();

                    if (mode === 'ai' && gameActive && winner === null && currentPlayer === 1) {
                        setTimeout(() => aiMove(), 300);
                    }
                    return;
                }

                // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
                selectedRow = -1;
                possibleMoves = [];
                renderBoard();
            }

            function checkChessEnd() {
                // –£–ø—Ä–æ—â—ë–Ω–Ω–æ
            }

            function checkCheckersEnd() {
                let whiteExists = false, blackExists = false;
                for (let r=0; r<8; r++) {
                    for (let c=0; c<8; c++) {
                        const p = boardState[r][c];
                        if (p === 'w' || p === 'W') whiteExists = true;
                        if (p === 'b' || p === 'B') blackExists = true;
                    }
                }
                if (!whiteExists) {
                    winner = 'black';
                    gameActive = false;
                    statusEl.innerText = '–ß—ë—Ä–Ω—ã–µ –ø–æ–±–µ–¥–∏–ª–∏!';
                } else if (!blackExists) {
                    winner = 'white';
                    gameActive = false;
                    statusEl.innerText = '–ë–µ–ª—ã–µ –ø–æ–±–µ–¥–∏–ª–∏!';
                }
            }

            function aiMove() {
                // –ü—Ä–æ—Å—Ç–æ–π AI ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π —Ö–æ–¥
                if (!gameActive || winner !== null || currentPlayer !== 1) return;
                let allMoves = [];
                for (let r=0; r<8; r++) {
                    for (let c=0; c<8; c++) {
                        const piece = boardState[r][c];
                        if (piece && ((currentPlayer === 1 && piece === piece.toLowerCase()))) {
                            const moves = getPossibleMoves(r, c);
                            moves.forEach(m => allMoves.push({ fromRow: r, fromCol: c, ...m }));
                        }
                    }
                }
                if (allMoves.length === 0) return;
                const move = allMoves[Math.floor(Math.random() * allMoves.length)];
                makeMove(move.fromRow, move.fromCol, move.row, move.col, move);
                currentPlayer = 0;
                renderBoard();
                statusEl.innerText = '–•–æ–¥ –±–µ–ª—ã—Ö';
                checkCheckersEnd();
            }

            function showHint() {
                if (!gameActive || winner !== null) return;
                if (mode === 'ai' && currentPlayer !== 0) return;
                let allMoves = [];
                for (let r=0; r<8; r++) {
                    for (let c=0; c<8; c++) {
                        const piece = boardState[r][c];
                        if (piece && ((currentPlayer === 0 && piece === piece.toUpperCase()) || (currentPlayer === 1 && piece === piece.toLowerCase()))) {
                            const moves = getPossibleMoves(r, c);
                            moves.forEach(m => allMoves.push({ fromRow: r, fromCol: c, ...m }));
                        }
                    }
                }
                if (allMoves.length === 0) return;
                const hintMove = allMoves[Math.floor(Math.random() * allMoves.length)];
                selectedRow = hintMove.fromRow;
                selectedCol = hintMove.fromCol;
                possibleMoves = [{ row: hintMove.row, col: hintMove.col, attack: hintMove.attack }];
                renderBoard();
                setTimeout(() => {
                    selectedRow = -1;
                    possibleMoves = [];
                    renderBoard();
                }, 1500);
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä
            selectCheckers.addEventListener('click', () => {
                selectCheckers.classList.add('active');
                selectChess.classList.remove('active');
                currentGame = 'checkers';
                initCheckers();
            });

            selectChess.addEventListener('click', () => {
                selectChess.classList.add('active');
                selectCheckers.classList.remove('active');
                currentGame = 'chess';
                initChess();
            });

            mode2p.addEventListener('click', () => {
                mode2p.classList.add('active');
                modeAI.classList.remove('active');
                mode = '2p';
                if (currentGame === 'checkers') initCheckers(); else initChess();
            });

            modeAI.addEventListener('click', () => {
                modeAI.classList.add('active');
                mode2p.classList.remove('active');
                mode = 'ai';
                if (currentGame === 'checkers') initCheckers(); else initChess();
            });

            diffBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    diffBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    difficulty = btn.dataset.level;
                });
            });

            hintBtn.addEventListener('click', showHint);
            newGameBtn.addEventListener('click', () => {
                if (currentGame === 'checkers') initCheckers(); else initChess();
            });
            resetGameBtn.addEventListener('click', () => {
                if (currentGame === 'checkers') initCheckers(); else initChess();
            });

            // –°—Ç–∞—Ä—Ç
            initCheckers();
        })();
    </script>
</body>
</html>
